<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <!-- MOTW-DISABLED saved from url=(0014)about:internet -->
    <title>Adding Advanced Security Layers to a WS-I Web Service</title>
    <link rel="StyleSheet" href="css/webservices-wsi-publish.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/context.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/towwhdir.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/wwhpagef.js"></script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        var  WebWorksRootPath = "";
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        // Set reference to top level help frame
        //
        var  WWHFrame = WWHGetWWHFrame("", true);
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2" src="scripts/expand.js"></script>
    <!-- THE FOLLOWING IS A GUIDEWIRE STYLE DEFINITION FOR THE LINK TO THIS FEATURE -->
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <!-- THE FOLLOWING IS A GUIDEWIRE GSCRIPT FUNCTION FOR THE LINK TO THIS FEATURE -->
    <script type="text/javascript">
function guidewire_selectall()
{
var text_val=eval("document.linktothisurlform.urlfield");
text_val.focus();
text_val.select();
}
</script>
  </head>
  <body onLoad="WWHUpdate();" onUnload="WWHUnload();" onKeyDown="WWHHandleKeyDown((document.all||document.getElementById||document.layers)?event:null);" onKeyPress="WWHHandleKeyPress((document.all||document.getElementById||document.layers)?event:null);" onKeyUp="WWHHandleKeyUp((document.all||document.getElementById||document.layers)?event:null);">
    <!-- THE FOLLOWING IS A GUIDEWIRE DIV FOR THE 'LINK TO THIS' FEATURE -->
    <div id="linkToThisPage" class="popup" style="display: none;">
      <div class="popupTitle">Link Directly to This Page 
           <a href="#" onclick="var thePopup = getElementById('linkToThisPage');thePopup.style.display='none';return false;"><img class="popupClosebox" src="wwhelp/wwhimpl/common/images/close.gif" /></a></div>
      <div style="padding:6px;">
        <div class="popupText" id="linkToThisPageBookmark">An error has occurred if you see this messsage.</div>
        <form name="linktothisurlform" method="post" action="" style="width:275px;margin:0px">
          <input type="text" class="popupURLText" id="linkToThisPageURL" name="urlfield" rows="1" cols="55" onClick="guidewire_selectall();" onFocus="guidewire_selectall();"></input>
        </form>
      </div>
    </div>
    <br />
    <div class="WebWorks_Breadcrumbs" style="text-align: left;">
      <span>ClaimCenter Integration Guide</span> : 
    <span class="WebWorks_Breadcrumbs" style="text-align: left;"><a class="WebWorks_Breadcrumb_Link" href="p-webservices.html#3699120">Web Services</a> : <a class="WebWorks_Breadcrumb_Link" href="webservices-wsi-publish.07.01.html#3699120">Publishing Web Services (WS-I)</a> : Adding Advanced Security Layers to a WS-I Web Service</span></div>
    <hr align="left" />
    <blockquote>
      <h3 class="H1_-_Heading_1"><a name="3699120">Adding Advanced Security Layers to a WS-I Web Service</a></h3>
      <div class="B_-_Body"><a name="3699121">For security options beyond simple HTTP authentication and Guidewire authentication, you can use an additional set of APIs to implement additional layers of security. For example, you might want to add additional layers of encryption, digital signatures, or other types of authentication or security. From the SOAP server side, you add advanced security layers to outgoing requests by applying transformations to the data stream of the request. </a></div>
      <h4 class="H2_-_Heading_2"><a name="3748909">Data Stream Transformations</a></h4>
      <div class="H3_-_Heading_3_outer" style="margin-left: 36pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <h5 class="H3_-_Heading_3_inner" style="width: 18pt; white-space: nowrap"></h5>
            </td>
            <td width="100%">
              <h5 class="H3_-_Heading_3_inner"><a name="3699122">Transformations on Data Streams</a></h5>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="3699123">You can transform the data stream by processing it incrementally, byte by byte. For example, you can implement an encryption security layer by transforming the request data stream incrementally. Alternatively, you can transform the data stream by processing it as an entire unit at one time. For example, you must implement a digital signature authentication layer by transforming the entire request data stream at one time. </a></div>
      <div class="B_-_Body"><a name="3699124">You can apply multiple types of transformations to the request data stream to add multiple security layers to your web service. The order of your transformations is important. For example, an encryption transformation followed by a digital signature transformation produces a different request data stream than a digital signature transformation followed by an encryption transformation.</a></div>
      <div class="B_-_Body"><a name="3749508">If your desired transformation operates more naturally on XML elements and not a byte stream, instead consider using the APIs in </a><a href="javascript:WWHClickedPopup('integration', 'webservices-wsi-publish.07.09.html#3749292', '');" title="Request or Response XML Structural Transformations">“Request or Response XML Structural Transformations”</a></div>
      <div class="H3_-_Heading_3_outer" style="margin-left: 36pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <h5 class="H3_-_Heading_3_inner" style="width: 18pt; white-space: nowrap"></h5>
            </td>
            <td width="100%">
              <h5 class="H3_-_Heading_3_inner"><a name="3699125">Accessing Data Streams</a></h5>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="3699126">To access the data stream for a request, Gosu provides an annotation (</a><span class="cv_-_computer_voice">WsiRequestTransform</span>) to inspect or transform an incoming request data stream. Gosu provides another annotation (<span class="cv_-_computer_voice">WsiResponseTransform</span>) to inspect or transform an outgoing response data stream. Both annotations take a Gosu block that takes an input stream (<span class="cv_-_computer_voice">java.io.InputStream</span>) and returns another input stream. Gosu calls the annotation block for every request or response, depending on the type of annotation.</div>
      <div class="H3_-_Heading_3_outer" style="margin-left: 36pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <h5 class="H3_-_Heading_3_inner" style="width: 18pt; white-space: nowrap"></h5>
            </td>
            <td width="100%">
              <h5 class="H3_-_Heading_3_inner"><a name="3699127">Example of Data Stream Request and Response Transformations</a></h5>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="3699128">The following example implements a request transform and a response transform to apply a simple encryption security layer to a web service. </a></div>
      <div class="B_-_Body"><a name="3699129">The example applies the same incremental transformation to the request and the response data streams. The transformation processes the data streams byte by byte to change the bits in each byte from a </a><span class="cv_-_computer_voice">1</span> to a <span class="cv_-_computer_voice">0</span> or a <span class="cv_-_computer_voice">0</span> to a <span class="cv_-_computer_voice">1</span>. The example transformation code uses the Gosu bitwise exclusive OR (XOR) logical operator (<span class="cv_-_computer_voice">^</span>) to perform the bitwise changes on each byte. The XOR logical operator is a <span class="e_-_emphasis">symmetrical</span> operation. If you apply XOR operation to a data stream and then apply the operation again to the transformed data stream, you obtain the original data stream. Therefore, transforming the incoming request data stream by using the XOR operation encrypts the data. Conversely, transforming the outgoing response data stream by using the XOR operation decrypts the data.</div>
      <PRE class="CF_-_Code_First_Line"><a name="3699130">package gw.webservice.example</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699131">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699132">uses gw.util.</a><span class="s_-_strong">StreamUtil</span></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699133">uses gw.xml.ws.annotation.WsiWebService</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><span class="s_-_strong"><a name="3699134">uses </a></span>gw.xml.ws.annotation.<span class="s_-_strong">WsiRequestTransform</span></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699135">uses gw.xml.ws.annotation.</a><span class="s_-_strong">WsiResponseTransform</span></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699136">uses java.io.ByteArrayInputStream</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699137">uses java.io.InputStream</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699138">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699139">@WsiWebService</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699140">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699141">// Specify data stream transformations for web service requests and responses. </a></PRE>
      <PRE class="CM_-_Code_Middle_Line" style="font-style: normal; font-variant: normal; font-weight: bold; text-transform: none; vertical-align: baseline"><span class="s_-_strong"><a name="3699142">@WsiRequestTransform(WsiTransformTestService._xorTransform)</a></span></PRE>
      <PRE class="CM_-_Code_Middle_Line" style="font-style: normal; font-variant: normal; font-weight: bold; text-transform: none; vertical-align: baseline"><span class="s_-_strong"><a name="3699143">@WsiResponseTransform(WsiTransformTestService._xorTransform)</a></span></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699144">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699145">class </a><span class="s_-_strong">WsiTransformTestService</span> {</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699146">  </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699147">&nbsp;&nbsp;// Declare a static variable to hold a Gosu block that encrypts and decrypts data streams. </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699148">&nbsp;&nbsp;public static var </a><span class="s_-_strong">_xorTransform</span>(inputStream : InputStream) : InputStream = \ inputStream -&gt;{</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699149">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699150">&nbsp;&nbsp;&nbsp;&nbsp;// Get the input stream, and store it in a byte array. </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699151">&nbsp;&nbsp;&nbsp;&nbsp;var bytes = </a><span class="s_-_strong">StreamUtil.getContent(inputStream)</span> </PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699152">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699153">&nbsp;&nbsp;&nbsp;&nbsp;// Encrypt the bits in each byte. </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699154">&nbsp;&nbsp;&nbsp;&nbsp;for (b in bytes index idx) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699155">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bytes[idx] = (b </a><span class="s_-_strong">^</span> 17) as byte &nbsp;// XOR encryption with “17” as the encryption mask</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699156">&nbsp;&nbsp;&nbsp;&nbsp;}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699157">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699158">&nbsp;&nbsp;&nbsp;&nbsp;return new ByteArrayInputStream(bytes)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699159">&nbsp;&nbsp;}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699160">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699161">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699162">&nbsp;&nbsp;function add(a : int, b : int) : int {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699163">&nbsp;&nbsp;&nbsp;&nbsp;return a + b</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699164">&nbsp;&nbsp;}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699165">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699166">&nbsp;</a></PRE>
      <PRE class="CL_-_Code_Last_Line"><a name="3699167">}</a></PRE>
      <div class="B_-_Body"><a name="3699168">In the preceding example, the request transformation and the response transformation use the same Gosu block for transformation logic because the block uses a symmetrical algorithm. In a typical production scenario however, the request transformation and the response transformation use different Gosu blocks because their transformation logic differs. </a></div>
      <h6 class="HS_-_Head_Sub"><a name="3699169">See also</a></h6>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a href="javascript:WWHClickedPopup('integration', 'webservices-wsi-publish.07.07.html#3699181', '');" title="Adding Advanced Security Layers to a WS-I Web Service" name="3699173">“Using WSS4J for Encryption, Signatures, and Other Security Headers”</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a href="javascript:WWHClickedPopup('gosu', 'expressions.05.05.html#1573811', '');" title="Arithmetic Expressions" name="3699177">“Bitwise Exclusive OR (^)” in the </a><span class="bt_-_book_title"><a href="javascript:WWHClickedPopup('gosu', 'expressions.05.05.html#1573811', '');" title="Arithmetic Expressions">Gosu Reference Guide</a></span></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="H3_-_Heading_3_outer" style="margin-left: 36pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <h5 class="H3_-_Heading_3_inner" style="width: 18pt; white-space: nowrap"></h5>
            </td>
            <td width="100%">
              <h5 class="H3_-_Heading_3_inner"><a name="3699178">Applying Multiple Security Layers to a WS-I Web Service</a></h5>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="3699179">Whenever you apply multiple layers of security to your web service, the order of substeps in your request&nbsp;and response transformation blocks is critical. Typically, the order of substeps in your response block reverses the order of substeps in your request block. For example, if you encrypt and then add a digital signature to the response data stream, remove the digital signature before decrypting the request data stream. If you remove a security layers from your web service, assure the remaining layers preserve the correct order of substeps in the transformation blocks. </a></div>
      <div class="H3_-_Heading_3_outer" style="margin-left: 36pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <h5 class="H3_-_Heading_3_inner" style="width: 18pt; white-space: nowrap"></h5>
            </td>
            <td width="100%">
              <h5 class="H3_-_Heading_3_inner"><a name="3699181">Using WSS4J for Encryption, Signatures, and Other Security Headers</a></h5>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="3699182">The following example uses the Java utility </a><span class="cv_-_computer_voice">WSS4J</span> to implement encryption, digital cryptographic signatures, and other security elements (a <span class="cv_-_computer_voice">timestamp</span>). This example has three parts.</div>
      <h6 class="HS_-_Head_Sub"><a name="3699183">Part 1 of the Example that Uses </a><span class="cvh_-_computer_voice_in_heading">WSS4J</span></h6>
      <div class="B_-_Body"><a name="3699184">The first part of the example is a utility class called </a><span class="cv_-_computer_voice">demo.DemoCrypto</span> that implements an input stream encryption routine that adds a timestamp, then a digital signature, then encryption. To decrypt the input stream for a request, the utility class knows how to decrypt the input stream and then validate the digital signature. </div>
      <div class="B_-_Body"><a name="3699185">Early in the encryption (</a><span class="cv_-_computer_voice">addCrypto</span>) and decryption (<span class="cv_-_computer_voice">removeCrypto</span>) methods, the code parses, or inflates, the XML request and response input streams into hierarchical DOM trees that represent the XML. The methods call the internal class method <span class="cv_-_computer_voice">parseDOM</span> to parse input streams into DOM trees. </div>
      <div class="B_-_Body"><a name="3699186">Parsing the input streams in DOM tress is an important step. Some of the encryption information, such as timestamps and digital signatures, must be added in a particular place in the SOAP envelope. At the end of the encryption and decryption methods, the code serializes, or flattens, the DOM trees back into XML request and response input streams. The methods call the internal class method </a><span style="font-family: &quot;Lucida Sans Typewriter&quot;; font-size: 7.0pt">serializeDOM</span> to serialize DOM trees back into input streams.</div>
      <PRE class="CF_-_Code_First_Line"><a name="3699187">package gw.webservice.example</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699188">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699189">uses gw.api.util.ConfigAccess</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699190">uses java.io.ByteArrayInputStream</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699191">uses java.io.ByteArrayOutputStream</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699192">uses java.io.InputStream</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699193">uses java.util.Vector</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699194">uses java.util.Properties</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699195">uses java.lang.RuntimeException</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699196">uses javax.xml.parsers.DocumentBuilderFactory</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699197">uses javax.xml.transform.TransformerFactory</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699198">uses javax.xml.transform.dom.DOMSource</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699199">uses javax.xml.transform.stream.StreamResult</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699200">uses org.apache.ws.security.message.*</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699201">uses org.apache.ws.security.*</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699202">uses org.apache.ws.security.handler.*</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699203">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699204">// Demonstration input stream encryption and decryption functions. </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699205">// The layers of security are a timestamp, a digital signature, and encryption.</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699206">class </a><span class="s_-_strong">DemoCrypto</span> {</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699207">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699208">&nbsp;&nbsp;// Encrypt an input stream. </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699209">&nbsp;&nbsp;static function </a><span class="s_-_strong">addCrypto</span>(inputStream : InputStream) : InputStream {</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699210">&nbsp;&nbsp;&nbsp;&nbsp;var crypto = getCrypto()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699211">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699212">&nbsp;&nbsp;&nbsp;&nbsp;// Parse the input stream into a DOM (Document Object Model) tree. </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699213">&nbsp;&nbsp;&nbsp;&nbsp;var domEnvironment = </a><span class="s_-_strong">parseDOM(inputStream)</span></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699214">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699215">&nbsp;&nbsp;&nbsp;&nbsp;var securityHeader = new WSSecHeader()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699216">&nbsp;&nbsp;&nbsp;&nbsp;securityHeader.insertSecurityHeader(domEnvironment);</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699217">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699218">&nbsp;&nbsp;&nbsp;&nbsp;var timeStamp = new WSSecTimestamp();</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699219">&nbsp;&nbsp;&nbsp;&nbsp;timeStamp.setTimeToLive(600)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699220">&nbsp;&nbsp;&nbsp;&nbsp;domEnvironment = timeStamp.build(domEnvironment, securityHeader)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699221">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699222">&nbsp;&nbsp;&nbsp;&nbsp;var signer = new WSSecSignature();</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699223">&nbsp;&nbsp;&nbsp;&nbsp;signer.setUserInfo("ws-client", "client-password")</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699224">&nbsp;&nbsp;&nbsp;&nbsp;var parts = new Vector()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699225">&nbsp;&nbsp;&nbsp;&nbsp;parts.add(new WSEncryptionPart("Timestamp", </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699226">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd", </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699227">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"Element"))</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699228">    parts.add(new WSEncryptionPart("Body", </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699229">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gw.xsd.w3c.soap12_envelope.Body.$QNAME.NamespaceURI, "Element"));</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699230">&nbsp;&nbsp;&nbsp;&nbsp;signer.setParts(parts);</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699231">&nbsp;&nbsp;&nbsp;&nbsp;domEnvironment = signer.build(domEnvironment, crypto, securityHeader);</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699232">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699233">&nbsp;&nbsp;&nbsp;&nbsp;var encrypt = new WSSecEncrypt()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699234">&nbsp;&nbsp;&nbsp;&nbsp;encrypt.setUserInfo("ws-client", "client-password")</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699235">&nbsp;&nbsp;&nbsp;&nbsp;// encryptionParts=</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699236">&nbsp;&nbsp;&nbsp;&nbsp;// {Element}{http://www.w3.org/2000/09/xmldsig#}Signature;{Content}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699237">&nbsp;&nbsp;&nbsp;&nbsp;// {http://schemas.xmlsoap.org/soap/envelope/}Body</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699238">&nbsp;&nbsp;&nbsp;&nbsp;parts = new Vector()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699239">&nbsp;&nbsp;&nbsp;&nbsp;parts.add(new WSEncryptionPart("Signature", "http://www.w3.org/2000/09/xmldsig#", "Element"))</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699240">&nbsp;&nbsp;&nbsp;&nbsp;parts.add(new WSEncryptionPart("Body", gw.xsd.w3c.soap12_envelope.Body.$QNAME.NamespaceURI,</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699241">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"Content"));</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699242">&nbsp;&nbsp;&nbsp;&nbsp;encrypt.setParts(parts)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699243">&nbsp;&nbsp;&nbsp;&nbsp;domEnvironment = encrypt.build(domEnvironment, crypto, securityHeader);</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699244">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699245">&nbsp;&nbsp;&nbsp;&nbsp;// Serialize the modifed DOM tree back into an input stream. </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699246">&nbsp;&nbsp;&nbsp;&nbsp;return new ByteArrayInputStream(</a><span class="s_-_strong">serializeDOM</span>(domEnvironment.DocumentElement))</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699247">&nbsp;&nbsp;}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699248">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699249">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699250">&nbsp;&nbsp;// Decrypt an input stream. </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699251">&nbsp;&nbsp;static function </a><span class="s_-_strong">removeCrypto</span>(inputStream : InputStream) : InputStream {</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699252">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699253">&nbsp;&nbsp;&nbsp;&nbsp;// Parse the input stream into a DOM (Document Object Model) tree. </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699254">&nbsp;&nbsp;&nbsp;&nbsp;var envelope = </a><span class="s_-_strong">parseDOM(inputStream)</span> </PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699255">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699256">&nbsp;&nbsp;&nbsp;&nbsp;var secEngine = WSSecurityEngine.getInstance();</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699257">&nbsp;&nbsp;&nbsp;&nbsp;var crypto = getCrypto()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699258">&nbsp;&nbsp;&nbsp;&nbsp;var results = secEngine.processSecurityHeader(envelope, null, \ callbacks -&gt;{</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699259">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (callback in callbacks) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699260">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (callback typeis WSPasswordCallback) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699261">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;callback.Password = "client-password"</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699262">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699263">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699264">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699265">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw new RuntimeException("Expected instance of WSPasswordCallback")</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699266">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699267">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699268">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699269">&nbsp;&nbsp;&nbsp;&nbsp;}, crypto);</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699270">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699271">&nbsp;&nbsp;&nbsp;&nbsp;for (result in results) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699272">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var eResult = result as WSSecurityEngineResult</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699273">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Note: An encryption action does not have an associated principal.</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699274">      //&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Only Signature and UsernameToken actions return a principal</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699275">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (eResult.Action != WSConstants.ENCR) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699276">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(eResult.Principal.Name);</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699277">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699278">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699279">&nbsp;&nbsp;&nbsp;&nbsp;}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699280">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699281">&nbsp;&nbsp;&nbsp;&nbsp;// Serialize the modifed DOM tree back into an input stream. </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699282">&nbsp;&nbsp;&nbsp;&nbsp;return new ByteArrayInputStream(</a><span class="s_-_strong">serializeDOM</span>(envelope.DocumentElement))</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699283">&nbsp;&nbsp;}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699284">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699285">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699286">&nbsp;&nbsp;// Private function to create a map of WSS4J cryptographic properties.</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699287">&nbsp;&nbsp;private static function getCrypto() : org.apache.ws.security.components.crypto.Crypto {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699288">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699289">&nbsp;&nbsp;&nbsp;&nbsp;var cryptoProps = new Properties()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699290">&nbsp;&nbsp;&nbsp;&nbsp;cryptoProps.put("org.apache.ws.security.crypto.merlin.keystore.alias", "ws-client")</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699291">&nbsp;&nbsp;&nbsp;&nbsp;cryptoProps.put("org.apache.ws.security.crypto.merlin.keystore.password", "client-password")</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699292">&nbsp;&nbsp;&nbsp;&nbsp;cryptoProps.put("org.apache.ws.security.crypto.merlin.keystore.type", "jks")</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699293">&nbsp;&nbsp;&nbsp;&nbsp;cryptoProps.put("org.apache.ws.security.crypto.merlin.file", ConfigAccess.getConfigFile(</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699294">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"config/etc/client-keystore.jks").CanonicalPath)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699295">&nbsp;&nbsp;&nbsp;&nbsp;cryptoProps.put("org.apache.ws.security.crypto.provider",</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699296">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"org.apache.ws.security.components.crypto.Merlin")</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699297">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699298">&nbsp;&nbsp;&nbsp;&nbsp;return org.apache.ws.security.components.crypto.CryptoFactory.getInstance(cryptoProps)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699299">&nbsp;&nbsp;}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699300">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699301">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699302">&nbsp;&nbsp;// Private function to parse an input stream into a hierarchical DOM tree.</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699303">&nbsp;&nbsp;private static function </a><span class="s_-_strong">parseDOM</span>(<span class="s_-_strong">inputStream : InputStream) : org.w3c.dom.Document</span> {</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699304">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699305">&nbsp;&nbsp;&nbsp;&nbsp;var factory = DocumentBuilderFactory.newInstance();</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699306">&nbsp;&nbsp;&nbsp;&nbsp;factory.setNamespaceAware(true);</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699307">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699308">&nbsp;&nbsp;&nbsp;&nbsp;return factory.newDocumentBuilder().parse(inputStream);</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699309">&nbsp;&nbsp;}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699310">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699311">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699312">&nbsp;&nbsp;// Private function to serialize a hierarchical DOM tree into an input stream.</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699313">&nbsp;&nbsp;private static function </a><span class="s_-_strong">serializeDOM(element : org.w3c.dom.Element) : byte[]</span> {</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699314">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699315">&nbsp;&nbsp;&nbsp;&nbsp;var transformerFactory = TransformerFactory.newInstance();</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699316">&nbsp;&nbsp;&nbsp;&nbsp;var transformer = transformerFactory.newTransformer();</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699317">&nbsp;&nbsp;&nbsp;&nbsp;var baos = new ByteArrayOutputStream();</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699318">&nbsp;&nbsp;&nbsp;&nbsp;transformer.transform(new DOMSource(element), new StreamResult(baos));</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699319">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699320">&nbsp;&nbsp;&nbsp;&nbsp;return baos.toByteArray();</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699321">&nbsp;&nbsp;}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699322">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699323">&nbsp;</a></PRE>
      <PRE class="CL_-_Code_Last_Line"><a name="3699324">}</a></PRE>
      <h6 class="HS_-_Head_Sub"><a name="3699325">Part 2 of the Example that Uses </a><span class="cvh_-_computer_voice_in_heading">WSS4J</span></h6>
      <div class="B_-_Body"><a name="3699326">The next part of this example is a WS-I web service implementation class written in Gosu. The following sample Gosu code implements the web service in the class </a><span class="cv_-_computer_voice">demo.DemoService</span>.</div>
      <PRE class="CF_-_Code_First_Line"><a name="3699327">package gw.webservice.example</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699328">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699329">uses gw.xml.ws.annotation.WsiWebService</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699330">uses gw.xml.ws.annotation.WsiRequestTransform</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699331">uses gw.xml.ws.annotation.WsiResponseTransform</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699332">uses gw.xml.ws.annotation.WsiPermissions</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699333">uses gw.xml.ws.annotation.WsiAvailability</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699334">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699335">@WsiWebService</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699336">@WsiAvailability(NONE)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699337">@WsiPermissions({})</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><span class="s_-_strong"><a name="3699338">@WsiRequestTransform</a></span>(\ inputStream -&gt;DemoCrypto.<span class="s_-_strong">removeCrypto(inputStream)</span>)</PRE>
      <PRE class="CM_-_Code_Middle_Line"><span class="s_-_strong"><a name="3699339">@WsiResponseTransform</a></span>(\ inputStream -&gt;DemoCrypto.<span class="s_-_strong">addCrypto(inputStream)</span>)</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699340">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699341">// This web service computes the sum of two integers. The web service decrypts incoming SOAP</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699342">// requests and encrypts outgoing SOAP responses. </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699343">class DemoService {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699344">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699345">&nbsp;&nbsp;// Compute the sum of two integers. </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699346">&nbsp;&nbsp;function add(a : int, b : int) : int {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699347">&nbsp;&nbsp;&nbsp;&nbsp;</a><span class="s_-_strong">return a + b</span></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699348">&nbsp;&nbsp;}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699349">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699350">&nbsp;</a></PRE>
      <PRE class="CL_-_Code_Last_Line"><a name="3699351">}</a></PRE>
      <div class="B_-_Body"><a name="3699352">Some things to notice about the preceding web service implementation class:</a></div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="3699353">The web service itself simply adds two numbers, but the service has a request and response transformation.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="3699354">The request transformation removes and confirms the cryptographic layer on the request, including the digital signature and encryption. The request transformation calls </a><span class="cv_-_computer_voice">DemoCrypto.removeCrypto(inputStream)</span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="3699355">The response transformation adds the cryptographic layer on the response. The response transformation calls </a><span class="cv_-_computer_voice">DemoCrypto.addCrypto(inputStream)</span></div>
            </td>
          </tr>
        </table>
      </div>
      <h6 class="HS_-_Head_Sub"><a name="3699356">Part 3 of the Example that Uses </a><span class="cvh_-_computer_voice_in_heading">WSS4J</span></h6>
      <div class="B_-_Body"><a name="3699357">The third and final part of this example is code to test this web service. </a></div>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699358">var webService = new </a><span class="s_-_strong">wsi.local</span>.demo.demoservice.<span class="s_-_strong">DemoService()</span></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699359">webService.Config.RequestTransform = \ inputStream -&gt;demo.DemoCrypto.addCrypto(inputStream)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699360">webService.Config.ResponseTransform = \ inputStream -&gt;demo.DemoCrypto.removeCrypto(inputStream)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3699361">print(webService.add(3, 5))</a></PRE>
      <div class="B_-_Body"><a name="3699362">Paste this code into the Gosu Scratchpad and run it. </a></div>
      <h6 class="HS_-_Head_Sub" style="color: #000000; font-style: normal; font-variant: normal; font-weight: bold; margin-top: 10.4pt; text-transform: none; vertical-align: baseline"><span class="ri_-_run_in_header"><a name="3699363">See also</a></span></h6>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a href="javascript:WWHClickedPopup('integration', 'webservices-wsi-publish.07.05.html#3780870', '');" title="Testing WS-I Web Services with wsi.local" name="3699367">“Testing WS-I Web Services with wsi.local”</a></div>
            </td>
          </tr>
        </table>
      </div>
      <h4 class="H2_-_Heading_2"><a name="3699369">WS-I Web Services Authentication Plugin</a></h4>
      <div class="B_-_Body"><a name="3699373">To handle the name/password authentication for a user connecting to WS-I web services, ClaimCenter delegates this job to the currently registered implementation of the </a><span class="cv_-_computer_voice">WebservicesAuthenticationPlugin</span> plugin interface. There must always be a registered version of this plugin, otherwise web services that require permissions cannot authenticate successfully.</div>
      <div class="H3_-_Heading_3_outer" style="margin-left: 36pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <h5 class="H3_-_Heading_3_inner" style="width: 18pt; white-space: nowrap"></h5>
            </td>
            <td width="100%">
              <h5 class="H3_-_Heading_3_inner"><a name="3699374">The Default Web Services Authentication Plugin Implementation</a></h5>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="3699378">The default configuration of ClaimCenter has a registered built-in implementation of WS-I web service authentication plugin, called </a><span class="cv_-_computer_voice">gw.plugin.security.DefaultWebservicesAuthenticationPlugin</span>. This internal class looks at HTTP request headers for authentication information and performs the default authentication against the local ClaimCenter users in the database. </div>
      <div class="B_-_Body"><a name="3699382">The </a><span class="cv_-_computer_voice">DefaultWebservicesAuthenticationPlugin</span> plugin implementation supports WS-I web service connections only. This plugin does not support authentication for the older style of RPCE web services nor for authenticating login from the application user interface. </div>
      <div class="H3_-_Heading_3_outer" style="margin-left: 36pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <h5 class="H3_-_Heading_3_inner" style="width: 18pt; white-space: nowrap"></h5>
            </td>
            <td width="100%">
              <h5 class="H3_-_Heading_3_inner"><a name="3699383">Writing Your Own Implementation of the Default Web Services Authentication Plugin </a></h5>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="3699384">To change the default web services authentication behavior, write your own class that implements the </a><span class="cv_-_computer_voice">WebservicesAuthenticationPlugin</span> plugin interface. For example, to implement your own single sign on system, implement your plugin to work with your LDAP server or other centralized authentication system. </div>
      <div class="B_-_Body"><a name="3699385">The </a><span class="cv_-_computer_voice">WebservicesAuthenticationPlugin</span> interface has a single plugin method that your implementation must implement, called <span class="cv_-_computer_voice">authenticate</span>. The <span class="cv_-_computer_voice">authenticate</span> method takes one parameter of type <span class="cv_-_computer_voice">gw.plugin.security.WebservicesAuthenticationContext</span>. The object passed to your <span class="cv_-_computer_voice">authenticate</span> method contains authentication information, such as the name and password. </div>
      <h6 class="HS_-_Head_Sub"><a name="3699386">Properties on a Web Services Authentication Context</a></h6>
      <div class="B_-_Body"><a name="3699387">Important properties on a </a><span class="cv_-_computer_voice">WebservicesAuthenticationContext</span> include:</div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="cv_-_computer_voice"><a name="3699388">HttpHeaders</a></span> – HTTP headers of type <span class="cv_-_computer_voice">gw.xml.ws.HttpHeaders</span>. This includes a list of header names</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="cv_-_computer_voice"><a name="3699389">HttpServletRequest</a></span> – the HTTP servlet request object, as the standard Java object <span class="cv_-_computer_voice">javax.servlet.http.HttpServletRequest</span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="cv_-_computer_voice"><a name="3699390">RequestSOAPHeaders</a></span> – The request SOAP headers, as an XML element (<span class="cv_-_computer_voice">XmlElement</span>)</div>
            </td>
          </tr>
        </table>
      </div>
      <h6 class="HS_-_Head_Sub"><a name="3699391">Values to Return from Your Default Web Services Authentication Plugin</a></h6>
      <div class="B_-_Body"><a name="3699392">The value that your implementation returns from its </a><span class="cv_-_computer_voice">authenticate</span> method depend on whether authentication succeeds:</div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="3699396">If authentication succeeds, return the relevant </a><span class="cv_-_computer_voice">User</span> object from the ClaimCenter database.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="3699397">If you cannot attempt to authenticate for some reason, such as network problems, return </a><span class="cv_-_computer_voice">null</span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="3699398">If authentication fails for other reasons, throw an exception of type </a><span class="cv_-_computer_voice">WsiAuthenticationException</span><span style="font-family: &quot;Lucida Sans Typewriter&quot;; font-size: 7.0pt">.</span></div>
            </td>
          </tr>
        </table>
      </div>
      <h6 class="HS_-_Head_Sub"><a name="3699399">See also</a></h6>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="3699402">To authenticate RPCE web services or user interface login, see </a><a href="javascript:WWHClickedPopup('integration', 'authentication.16.2.html#1454238', '');" title="Overview of User Authentication Interfaces">“Overview of User Authentication Interfaces”</a>.</div>
            </td>
          </tr>
        </table>
      </div>
      <script type="text/javascript" language="JavaScript1.2">
        <!--
          // Clear related topics
          //
          WWHClearRelatedTopics();

          document.writeln(WWHRelatedTopicsInlineHTML());
        // -->
      </script>
    </blockquote>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        document.write(WWHRelatedTopicsDivTag() + WWHPopupDivTag() + WWHALinksDivTag());
      // -->
    </script>
  </body>
</html>