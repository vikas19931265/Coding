<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <!-- MOTW-DISABLED saved from url=(0014)about:internet -->
    <title>What are Startable Plugins?</title>
    <link rel="StyleSheet" href="css/plugins-startable.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/context.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/towwhdir.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/wwhpagef.js"></script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        var  WebWorksRootPath = "";
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        // Set reference to top level help frame
        //
        var  WWHFrame = WWHGetWWHFrame("", true);
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2" src="scripts/expand.js"></script>
    <!-- THE FOLLOWING IS A GUIDEWIRE STYLE DEFINITION FOR THE LINK TO THIS FEATURE -->
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <!-- THE FOLLOWING IS A GUIDEWIRE GSCRIPT FUNCTION FOR THE LINK TO THIS FEATURE -->
    <script type="text/javascript">
function guidewire_selectall()
{
var text_val=eval("document.linktothisurlform.urlfield");
text_val.focus();
text_val.select();
}
</script>
  </head>
  <body onLoad="WWHUpdate();" onUnload="WWHUnload();" onKeyDown="WWHHandleKeyDown((document.all||document.getElementById||document.layers)?event:null);" onKeyPress="WWHHandleKeyPress((document.all||document.getElementById||document.layers)?event:null);" onKeyUp="WWHHandleKeyUp((document.all||document.getElementById||document.layers)?event:null);">
    <!-- THE FOLLOWING IS A GUIDEWIRE DIV FOR THE 'LINK TO THIS' FEATURE -->
    <div id="linkToThisPage" class="popup" style="display: none;">
      <div class="popupTitle">Link Directly to This Page 
           <a href="#" onclick="var thePopup = getElementById('linkToThisPage');thePopup.style.display='none';return false;"><img class="popupClosebox" src="wwhelp/wwhimpl/common/images/close.gif" /></a></div>
      <div style="padding:6px;">
        <div class="popupText" id="linkToThisPageBookmark">An error has occurred if you see this messsage.</div>
        <form name="linktothisurlform" method="post" action="" style="width:275px;margin:0px">
          <input type="text" class="popupURLText" id="linkToThisPageURL" name="urlfield" rows="1" cols="55" onClick="guidewire_selectall();" onFocus="guidewire_selectall();"></input>
        </form>
      </div>
    </div>
    <br />
    <div class="WebWorks_Breadcrumbs" style="text-align: left;">
      <span>ClaimCenter Integration Guide</span> : 
    <span class="WebWorks_Breadcrumbs" style="text-align: left;"><a class="WebWorks_Breadcrumb_Link" href="p-plugins.html#2422299">Plugins</a> : <a class="WebWorks_Breadcrumb_Link" href="plugins-startable.24.1.html#2422299">Startable Plugins</a> : What are Startable Plugins?</span></div>
    <hr align="left" />
    <blockquote>
      <h3 class="H1_-_Heading_1"><a name="2422299">What are Startable Plugins?</a></h3>
      <div class="B_-_Body"><a name="2422301">You can register custom code that runs at server startup in the form of a </a><span class="e_-_emphasis">startable plugin</span> implementation. You can use this type of plugin as a listener, such as listening to a JMS queue. You can selectively start or stop each startable plugin in the Internal Tools interface, unlike other types of plugins. </div>
      <div class="B_-_Body"><a name="2422302">For a cluster, by default startable plugins only operate on the batch server. However, you can configure it to run on all servers on the cluster. For more information, see </a><a href="javascript:WWHClickedPopup('integration', 'plugins-startable.24.2.html#2422484', '');" title="What are Startable Plugins?">“Configuring Startable Plugins to Run on All Servers”</a>.</div>
      <div class="B_-_Body"><a name="2422306">Startable plugins have similarities with the messaging reply plugin. They typically implement some sort of listener code that initially runs at start up. A messaging transport’s main task is to send a message to an external system and listen for the reply acknowledgment. However, this metaphor might not apply to some integrations if you do not need send outgoing messages about data changes using the event and messaging system. However, if you need listener code and it must initialize with server startup, use a startable plugin. </a></div>
      <div class="N_-_Note">
        <span class="n_-_note">Note: </span><a name="2422310">Some integrations require external code to trigger an action within ClaimCenter but do not need custom listener code. Depending on your needs, consider publishing a ClaimCenter web service instead of a startable plugin. For more information, see </a><a href="javascript:WWHClickedPopup('integration', 'webservices.06.1.html#3412469', '');" title="Web Services Introduction">“Web Services Introduction”</a>.</div>
      <div class="B_-_Body"><a name="2422320">For ClaimCenter users with administration privileges, you can view the status of each startable plugin and also start or stop each one. To view the status, go to </a><span class="ui_-_UI_element">Server Tools</span> → <span class="ui_-_UI_element">Startable&nbsp;Plugin</span>. You can change the PCF files for this user interface. For example, you could customize this view to provide detailed information on your startable plugin, on its underlying transport mechanism, or any other information.</div>
      <div class="B_-_Body"><a name="2422324">Register your startable plugin in Studio just like any other plugin. Find this plugin interface in the Studio Plugins&nbsp;Registry editor in the following location </a><span class="ui_-_UI_element">Configuration</span> → <span class="ui_-_UI_element">Plugins</span> → <span class="ui_-_UI_element">gw</span> → <span class="ui_-_UI_element">api</span> → <span class="ui_-_UI_element">startable</span> → <span class="ui_-_UI_element">IStartablePlugin</span>. Right-click on that interface name and choose <span class="ui_-_UI_element">Add implementation..</span>. This location is slightly different than most plugins, which are in <span class="ui_-_UI_element">Configuration</span> → <span class="ui_-_UI_element">Plugins</span> → <span class="ui_-_UI_element">gw</span> → <span class="ui_-_UI_element">plugin</span>.</div>
      <div class="NI_-_Note_Important">
        <span class="n_-_note">IMPORTANT   </span><a name="2422351">For another type of customer-defined background process, see </a><a href="javascript:WWHClickedPopup('integration', 'batchprocess.41.1.html#2185890', '');" title="Custom Batch Processes">“Custom Batch Processes”</a>. </div>
      <h4 class="H2_-_Heading_2"><a name="2422353">Writing a Startable Plugin</a></h4>
      <div class="B_-_Body"><a name="2422354">The basics for a startable plugin are relatively straightforward. Most of your coding of a startable plugin is implementing your custom listener code or other special service. Write a new class that implements the </a><span class="cv_-_computer_voice">IStartablePlugin</span> interface and implement the following methods:</div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="2422358">A </a><span class="cv_-_computer_voice">start</span> method to start your service (at startup, or from the <span class="ui_-_UI_element">Server Tools</span> → <span class="ui_-_UI_element">Startable&nbsp;Plugin </span>page)</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="2422362">A </a><span class="cv_-_computer_voice">stop</span> method to stop your service (from the <span class="ui_-_UI_element">Server Tools</span> → <span class="ui_-_UI_element">Startable&nbsp;Plugin </span>page)</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="2422363">A property accessor function to get the </a><span class="cv_-_computer_voice">State</span> property from your startable plugin. This method returns a typecode from the typelist <span class="cv_-_computer_voice">StartablePluginState</span>: the value <span class="cv_-_computer_voice">Stopped</span> or <span class="cv_-_computer_voice">Started</span>. The administration user interface uses this property accessor to show the state to the user. Define a private variable to hold the current state and your property accessor (get) function can look simple:</div>
            </td>
          </tr>
        </table>
      </div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422364">// private variables...</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422365">var _state = StartablePluginState.Stopped;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422366">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422367">...</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422368">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422369">// property accessor (get) function...</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422370">override property get State() : StartablePluginState {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422371">    return _state // return our private variable</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422372">  }</a></PRE>
      <div class="LP_-_List_Para"><a name="2422373">Alternatively, combine the variable definition with the shortcut keyword </a><span class="cv_-_computer_voice">as</span> to simplify your code. You can combine the variable definition with the property definition can be combined with the single variable definition:</div>
      <div class="CS_-_Code_Single_Line"><a name="2422374">var _state : StartablePluginState as State</a></div>
      <div class="B_-_Body"><a name="2422376">The plugin does include a constructor called on system startup. However, start your service code in the </a><span class="cv_-_computer_voice">start</span> method, not the constructor. Your start method must appropriately set the state (started or stopped) using an internal variable that you define. </div>
      <div class="B_-_Body"><a name="2422377">At minimum, your start method must set your internal variable that tracks your started or stopped state, with code such as:</a></div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422378">_state = Started</a></PRE>
      <div class="B_-_Body"><a name="2422379">Additionally, in your </a><span class="cv_-_computer_voice">start</span> method, start any listener code or threads such as a JMS queue listener.</div>
      <div class="B_-_Body"><a name="2422380">Your </a><span class="cv_-_computer_voice">start</span> method has a method parameter that is a callback handler of type <span class="cv_-_computer_voice">StartablePluginCallbackHandler</span>. This callback is important if your startable plugin modifies any entity data, which is likely the case for most real-world startable plugins. </div>
      <div class="B_-_Body"><a name="2422381">Your plugin must run any code that affects entity data within a code block that you pass to the callback handler method called </a><span class="cv_-_computer_voice">execute</span>. The <span class="cv_-_computer_voice">execute</span> method takes as its argument a <span class="e_-_emphasis">Gosu block</span>, which is a special type of in-line function. The Gosu block you pass to the <span class="cv_-_computer_voice">execute</span> method takes no arguments. For more information, see <a href="javascript:WWHClickedPopup('gosu', 'blocks.18.1.html#1445150', '');" title="Gosu Blocks">“Gosu Blocks” in the </a><span class="bt_-_book_title"><a href="javascript:WWHClickedPopup('gosu', 'blocks.18.1.html#1445150', '');" title="Gosu Blocks">Gosu Reference Guide</a></span>. </div>
      <div class="N_-_Note">
        <span class="n_-_note">Note: </span><a name="2422385">If you do not need a user context, use the simplest version of the callback handler method </a><span class="cv_-_computer_voice">execute</span>, whose one argument is the Gosu block. To run your code as a specific user, see <a href="javascript:WWHClickedPopup('integration', 'plugins-startable.24.2.html#2422435', '');" title="What are Startable Plugins?">“User Contexts for Startable Plugins”</a>.</div>
      <div class="B_-_Body"><a name="2422389">You do not need to create a separate bundle. If you create new entities to the current bundle, they are in the correct (default) database transaction the application sets up for you. Use the code </a><span class="cv_-_computer_voice">Transaction.getCurrent()</span> to get the current bundle if you need a reference to the current (writable) bundle. For more information, see <a href="javascript:WWHClickedPopup('gosu', 'transactions.22.01.html#1456387', '');" title="Bundles and Database Transactions">“Bundles and Database Transactions” in the </a><span class="bt_-_book_title"><a href="javascript:WWHClickedPopup('gosu', 'transactions.22.01.html#1456387', '');" title="Bundles and Database Transactions">Gosu Reference Guide</a></span>.</div>
      <div class="NI_-_Note_Important">
        <span class="n_-_note">IMPORTANT   </span><a name="2422393">The Java language does not directly support blocks. If you implement your plugin in Java, you cannot use a Gosu block but you can use an anonymous class to do the same thing. For more information, see </a><a href="javascript:WWHClickedPopup('integration', 'plugins-startable.24.2.html#2422607', '');" title="What are Startable Plugins?">“If You Define Your Startable Plugin In Java”</a>.</div>
      <div class="B_-_Body"><a name="2422397">The plugin’s </a><span class="cv_-_computer_voice">start</span> method also includes a <span class="cv_-_computer_voice">boolean</span> variable that indicates whether the server is starting. If <span class="cv_-_computer_voice">true</span>, the server is starting up. If <span class="cv_-_computer_voice">false</span>, the start request comes from the <span class="ui_-_UI_element">Server Tools</span> user interface.</div>
      <div class="B_-_Body"><a name="2422398">The following shows a simple Gosu block that changes entity data. This example assumes your listener defined a variable </a><span class="cv_-_computer_voice">messageBody</span> with information from your remote system. If you get entities from a database query, remember to add them to the current bundle. Refer to <a href="javascript:WWHClickedPopup('gosu', 'querybuilder.10.32.html#2564207', '');" title="Updating Entity Instances in Query Results">“Updating Entity Instances in Query Results” in the </a><span class="bt_-_book_title"><a href="javascript:WWHClickedPopup('gosu', 'querybuilder.10.32.html#2564207', '');" title="Updating Entity Instances in Query Results">Gosu Reference Guide</a></span> for more information about bundles.</div>
      <div class="B_-_Body"><a name="2422402">This simple example queries all </a><span class="cv_-_computer_voice">User</span> entities and sets a property on results of the query:</div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422404">//variable definition earlier in your class...</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422405">var _callback : StartablePluginCallbackHandler;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422406">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422407">...</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422408">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422409">override function start( cbh: StartablePluginCallbackHandler, isStarting: boolean ) : void</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422410">  {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422411">    _callback = cbh</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422412">&nbsp;&nbsp;&nbsp;&nbsp;_callback.execute( \ -&gt; {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422413">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422414">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var q = gw.api.database.Query.make(User) // run a query</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422415">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var b = gw.Transaction.Transaction.Current // get the current bundle</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422416">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422417">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (e in q.select()) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422418">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422419">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// add entity instance to writable bundle, then save and only modify that result</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422420">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var writable_object = bundle.add(e) </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422421">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422422">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// modify properties as desired on the result of bundle.add(e)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422423">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;writable_object.Department = "Example of setting a property on a writable entity instance."</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422424">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422425">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422426">&nbsp;&nbsp;&nbsp;&nbsp;})</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422427">&nbsp;&nbsp;//Note: You do not need to commit the bundle here. The execute method commits after your block runs.</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422428">&nbsp;&nbsp;}</a></PRE>
      <div class="B_-_Body"><a name="2422429">Note that to make an entity instance writable, save and use the return result of the bundle </a><span class="cv_-_computer_voice">add</span> method. For more information, see <a href="javascript:WWHClickedPopup('gosu', 'transactions.22.04.html#1611659', '');" title="Adding Entity Instances to Bundles">“Adding Entity Instances to Bundles” in the </a><span class="bt_-_book_title"><a href="javascript:WWHClickedPopup('gosu', 'transactions.22.04.html#1611659', '');" title="Adding Entity Instances to Bundles">Gosu Reference Guide</a></span>.</div>
      <div class="B_-_Body"><a name="2422433">Just like your </a><span class="cv_-_computer_voice">start</span> method must set your internal variable that sets its state to started, your <span class="cv_-_computer_voice">stop</span> method must set your internal state variable to <span class="cv_-_computer_voice">StartablePluginState.Stopped</span>. Additionally, stop whatever background processes or listeners you started in your <span class="cv_-_computer_voice">start</span> method. For example, if your <span class="cv_-_computer_voice">start</span> method creates a new JMS queue listener, your <span class="cv_-_computer_voice">stop</span> method destroys the listener. Similar to the <span class="cv_-_computer_voice">start</span> method’s <span class="p_-_parameter">isStartingUp</span> parameter, the <span class="cv_-_computer_voice">stop</span> method includes a <span class="cv_-_computer_voice">boolean</span> variable that indicates whether the server is shutting down now. If <span class="cv_-_computer_voice">true</span>, the server is shutting down. If <span class="cv_-_computer_voice">false</span>, the stop request comes from the <span class="ui_-_UI_element">Server Tools</span> user interface.</div>
      <div class="H3_-_Heading_3_outer" style="margin-left: 36pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <h5 class="H3_-_Heading_3_inner" style="width: 18pt; white-space: nowrap"></h5>
            </td>
            <td width="100%">
              <h5 class="H3_-_Heading_3_inner"><a name="2422435">User Contexts for Startable Plugins</a></h5>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="2422436">If you use the simplest method signature for the </a><span class="cv_-_computer_voice">execute</span> method on <span style="font-family: &quot;Lucida Sans Typewriter&quot;; font-size: 7.0pt">StartablePluginCallbackHandler</span>, your code does not run with a current ClaimCenter user. Any code that directly or indirectly runs due to this plugin (including preupdate rules or any other code) must be prepared for the current user to be <span class="cv_-_computer_voice">null</span>. You must not rely on non-null values for current user if you use this version.</div>
      <div class="B_-_Body"><a name="2422440">However, there are alternate method signatures for the </a><span class="cv_-_computer_voice">execute</span> method. Use these to perform your startable plugin tasks as a specific <span class="cv_-_computer_voice">User</span>. Depending on the method variant, pass either a user name or the actual <span class="cv_-_computer_voice">User</span> entity.</div>
      <div class="B_-_Body"><a name="2422441">On a related note, the </a><span class="cv_-_computer_voice">gw.transaction.Transaction</span> class has an alternate version of the <span class="cv_-_computer_voice">runWithNewBundle</span> method to create a bundle with a specific user associated with it. You can use this in contexts in which there is no built-in user context or you need to use different users for different parts of your tasks. The method signature is:</div>
      <div class="CS_-_Code_Single_Line"><a name="2422442">gw.transaction.Transaction.runWithNewBundle(\ bundle -&gt; </a><span class="pc_-_parameter_in_code">YOUR_BLOCK_BODY</span>, user)</div>
      <div class="B_-_Body"><a name="2422443">For the second method argument to </a><span class="cv_-_computer_voice">runWithNewBundle</span>, pass either a <span class="cv_-_computer_voice">User</span> entity or a <span class="cv_-_computer_voice">String</span> that is the user name.</div>
      <div class="H3_-_Heading_3_outer" style="margin-left: 36pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <h5 class="H3_-_Heading_3_inner" style="width: 18pt; white-space: nowrap"></h5>
            </td>
            <td width="100%">
              <h5 class="H3_-_Heading_3_inner"><a name="2422444">Simple Startable Plugin Example</a></h5>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="2422445">The following is a complete simple startable plugin. This example does not do anything useful in its start method, but demonstrates the basic structure of creating a block that you pass to the callback handler’s </a><span class="cv_-_computer_voice">execute</span> method:</div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422446">package gw.api.startableplugin</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422447">uses gw.api.startable.IStartablePlugin</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422448">uses gw.api.startable.StartablePluginCallbackHandler</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422449">uses gw.api.startable.StartablePluginState</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422450">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422451">class HelloWorldStartablePlugin implements IStartablePlugin</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422452">{</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422453">  var _state = StartablePluginState.Stopped;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422454">  var _callback : StartablePluginCallbackHandler;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422455">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422456">  construct()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422457">  {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422458">  }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422459">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422460">  override property get State() : StartablePluginState</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422461">  {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422462">    return _state</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422463">  }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422464">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422465">  override function start( cbh: StartablePluginCallbackHandler, isStarting: boolean ) : void</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422466">  {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422467">    _callback = cbh</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422468">    _callback.execute( \ -&gt; {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422469">      // Do some work:</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422470">      // [...]</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422471">    } )</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422472">    _state = Started</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422473">    _callback.log( "*** From HelloWorldStartablePlugin: Hello world." )</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422474">  }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422475">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422476">  override function stop( isShuttingDown: boolean ) : void</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422477">  {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422478">    _callback.log( "*** From HelloWorldStartablePlugin: Goodbye." )</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422479">    _callback = null</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422480">    _state = Stopped</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422481">  }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422482">}</a></PRE>
      <h4 class="H2_-_Heading_2"><a name="2422484">Configuring Startable Plugins to Run on All Servers</a></h4>
      <div class="B_-_Body"><a name="2422485">For a cluster, by default startable plugins only operate on the batch server. However, you can configure it to run on all servers on the cluster by declaring the startable plugin is </a><span class="e_-_emphasis">distributed</span>. To declare the plugin is distributed, add the <span class="cv_-_computer_voice">@Distributed</span> annotation to the startable plugin implementation class.</div>
      <div class="B_-_Body"><a name="2422486">Guidewire strongly recommends that startable plugins very clearly and consistently save the state (started or stopped) across all servers in a cluster. This approach handles edge cases like a server joining the cluster late after other servers have started. To keep the state consistent across all servers, the state must persist in the database. Even though the state information in the database is not automatically persisted, the broadcast to other servers happens automatically.</a></div>
      <div class="B_-_Body"><a name="2422487">The series of steps is as follows:</a></div>
      <div class="LS_-_List_Start_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LS_-_List_Start_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">	1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LS_-_List_Start_inner"><a name="2422488">On any server, the server starts. The plugin method reads the second argument to the </a><span class="cv_-_computer_voice">start</span> method. Because the server is starting up, this value is <span class="cv_-_computer_voice">true</span>. The plugin implementation detects this condition and reads the database status of the started or stopped state and sets its own state appropriately.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">	2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><a name="2422489">Later, the state may changes on a server to start or stop from the user interface or through APIs. The application propagates this information to all servers in the cluster. Each server in the cluster decides whether it is appropriate to respect this request:</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI2_-_Bullet_Item_002c_Level_2_outer" style="margin-left: 67pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner"><a name="2422490">If the startable plugin is distributed, the server respects the request and calls the plugin </a><span class="cv_-_computer_voice">start</span> or <span class="cv_-_computer_voice">stop</span> method as appropriate. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI2_-_Bullet_Item_002c_Level_2_outer" style="margin-left: 67pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner"><a name="2422491">If the startable plugin is not distributed, only the batch server handles the request.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LP_-_List_Para"><a name="2422492">However, if the startable plugin is not distributed and the original changed server is the batch server, the behavior is different. The batch server does not bother with the distributed broadcast system because it is the only running version of the startable plugin. Instead, that server immediately calls the plugin </a><span class="cv_-_computer_voice">start</span> or <span class="cv_-_computer_voice">stop</span> method as appropriate.</div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">	3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><a name="2422493">On any server, the server shuts down. The plugin method reads the second argument to the </a><span class="cv_-_computer_voice">stop</span> method. Because the server is shutting down, this value is <span class="cv_-_computer_voice">true</span>. The plugin implementation detects this condition and simply stops its local state but does not set the database status in the database.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="2422494">Implement getting and setting the state information in the database using the plugin callback handler object, which is an instance of </a><span class="cv_-_computer_voice">StartablePluginCallbackHandler</span>. This object is a parameter to the <span class="cv_-_computer_voice">start</span> method of the plugin. Save a copy of this object as a private variable and then call the following methods on the object as needed:</div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="cv_-_computer_voice"><a name="2422495">getState</a></span> – Gets the state information in the database: <span class="cv_-_computer_voice">true</span> for started, <span class="cv_-_computer_voice">false</span> for stopped. If this is the first time in history that this startable plugin has ever run on this server-database cluster combination, its state information is not in the database. This method takes one arguments that represents the default assumption to use the very first time this query is checked. For example, if you expect this startable plugin to always run, pass the value <span class="cv_-_computer_voice">Started</span>. If this startable plugin runs only in rare situations and you expect only an administrator or API to trigger it to start, pass the value <span class="cv_-_computer_voice">Stopped</span>. If the server state has ever been set in the database, <span class="cv_-_computer_voice">getState</span> ignores this argument.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="cv_-_computer_voice"><a name="2422496">setState</a></span> – Sets the state information in the database for this startable plugin. This method takes one argument, which is true if and only if the startable plugin is running. This request attempts to set this information in the database if it is not yet set to the expected value. If the startable plugin state is already matching the database value for the state according to the <span class="cv_-_computer_voice">getState</span> method, do not call <span class="cv_-_computer_voice">setState</span>. Be careful to catch any exceptions. You must create your own bundle to make this change, see the example for how to use the <span class="cv_-_computer_voice">runWithNewBundle</span> API.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="cv_-_computer_voice"><a name="2422498">logStart</a></span> – Writes a line in the log about the plugin starting. This method takes one argument, which is line to log, as a <span class="cv_-_computer_voice">String</span>. Include the plugin name and the state, such as <span style="font-family: &quot;Lucida Sans Typewriter&quot;; font-size: 7.0pt">"HelloWorldDistributedStartablePlugin:Started"</span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="cv_-_computer_voice"><a name="2422499">logStop</a></span> – Writes a line in the log about the plugin stopping. This method takes one argument, which is line to log, as a <span class="cv_-_computer_voice">String</span>. Include the plugin name and the state, such as <span style="font-family: &quot;Lucida Sans Typewriter&quot;; font-size: 7.0pt">"HelloWorldDistributedStartablePlugin:Stopped"</span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="2422500">The following is an example implementation of the </a><span class="cv_-_computer_voice">start</span> and <span class="cv_-_computer_voice">stop</span> methods that implement a trivial thread and the proper setting of startable plugin state. </div>
      <PRE class="CF_-_Code_First_Line"><a name="2422501">package gw.api.startableplugin</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422502">uses gw.api.startable.IStartablePlugin</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422503">uses gw.api.startable.StartablePluginCallbackHandler</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422504">uses gw.api.startable.StartablePluginState</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422505">uses gw.transaction.Transaction</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422506">uses java.lang.Thread</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422507">uses gw.api.util.Logger</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422508">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422509">@Distributed</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422510">class HelloWorldDistributedStartablePlugin implements IStartablePlugin {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422511">  var _state : StartablePluginState;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422512">  var _startedHowManyTimes  = 0</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422513">  var _callback : StartablePluginCallbackHandler;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422514">  var _thread : Thread</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422515">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422516">  override property get State() : StartablePluginState  {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422517">    return _state</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422518">  }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422519">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422520">  override function start( handler : StartablePluginCallbackHandler, serverStartup: boolean ) : void  {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422521">    _callback = handler</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422522">    if (serverStartup) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422523">   &nbsp;&nbsp;// if the server is starting up, read the value from the database, and default to stopped</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422524">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// if this plugin NEVER saved its state before. You might want to change this to Started instead.</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422525">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_state = _callback.getState(Stopped)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422526">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422527">      if (_state == Started) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422528">        _callback.logStart("HelloWorldDistributedStartablePlugin:Started")</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422529">      }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422530">      else {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422531">        _callback.logStart("HelloWorldDistributedStartablePlugin:Stopped")</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422532">      }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422533">    }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422534">    else {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422535">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422536">      _state = Started</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422537">      if (_callback.State != Started) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422538">        changeState(Started) // call our internal function that sets the database state if necessary</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422539">      }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422540">      _callback.logStart("HelloWorldDistributedStartablePlugin")</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422541">    }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422542">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422543">&nbsp;&nbsp;&nbsp;&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422544">&nbsp;&nbsp;&nbsp;&nbsp;// if the thread already existed for some reason, briefly stop it before starting it again</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422545">    if (_state == Started) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422546">      if (_thread != null) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422547">        _thread.stop()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422548">      }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422549">&nbsp;&nbsp;&nbsp;&nbsp;_startedHowManyTimes++</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422550">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422551">&nbsp;&nbsp;&nbsp;&nbsp;// create your thread and start it</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422552">&nbsp;&nbsp;&nbsp;&nbsp;var t = new Thread() {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422553">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function run() {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422554">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print("hello!")</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422555">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422556">&nbsp;&nbsp;&nbsp;&nbsp;}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422557">&nbsp;&nbsp;&nbsp;&nbsp;t.Daemon=true</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422558">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422559">    }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422560">  }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422561">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422562">  override function stop( serverStopping : boolean ) : void  {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422563">    if (_thread != null) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422564">      _thread.stop()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422565">      _thread = null</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422566">    }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422567">    if (_callback != null) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422568">      if (serverStopping) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422569">        if (_state == Started) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422570">          _callback.logStop("HelloWorldDistributedStartablePlugin:Started")</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422571">        }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422572">        else {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422573">          _callback.logStop("HelloWorldDistributedStartablePlugin:Stopped")</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422574">        }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422575">        _callback = null</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422576">      }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422577">      else {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422578">        if (_callback.State != Stopped) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422579">          changeState(Stopped) // call our internal function that sets the database state if necessary</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422580">        }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422581">        _callback.logStop("HelloWorldDistributedStartablePlugin")</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422582">      }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422583">    }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422584">    _state = Stopped</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422585">  }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422586">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422587">&nbsp;&nbsp;// our internal function that sets the database state if necessary. if there are exceptions, </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422588">&nbsp;&nbsp;// this implementation tries 5 times. You might want a different behavior.</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422589">  private function changeState(newState : StartablePluginState) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422590">    var tryCount = 0</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422591">    while (_callback.State != newState &amp;&amp; tryCount &lt; 5) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422592">      try {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422593">        Transaction.runWithNewBundle(\ bundle -&gt; { _callback.setState(bundle, newState)},</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422594">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;User.util.UnrestrictedUser)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422595">      }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422596">      catch (e : java.lang.Exception) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422597">        tryCount++</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422598">        _callback.log(this.IntrinsicType.Name + " on attempt " + tryCount +</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422599">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" caught " + (typeof e).Name + ": " + e.Message)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422600">      }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422601">    }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422602">  }</a></PRE>
      <PRE class="CL_-_Code_Last_Line"><a name="2422603">}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422604">&nbsp;</a></PRE>
      <h4 class="H2_-_Heading_2"><a name="2422605">Important Notes for Java and Startable Plugins</a></h4>
      <div class="H3_-_Heading_3_outer" style="margin-left: 36pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <h5 class="H3_-_Heading_3_inner" style="width: 18pt; white-space: nowrap"></h5>
            </td>
            <td width="100%">
              <h5 class="H3_-_Heading_3_inner"><a name="2422607">If You Define Your Startable Plugin In Java</a></h5>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="2422608">In Gosu, your startable plugin must call the </a><span class="cv_-_computer_voice">execute</span> method on the callback handler object, as discussed in previous topics:</div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422609">override function start( cbh: StartablePluginCallbackHandler, isStarting: boolean ) : void {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422610">    _callback = cbh</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422611">&nbsp;&nbsp;&nbsp;&nbsp;_callback.execute( \ -&gt; {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422612">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//...</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422613">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</a></PRE>
      <PRE class="CL_-_Code_Last_Line"><a name="2422614">&nbsp;}</a></PRE>
      <div class="B_-_Body"><a name="2422615">However, the Java language does not directly support blocks. If you implement your plugin in Java, you cannot use a Gosu block. However, instead you can use an anonymous class.</a></div>
      <div class="B_-_Body"><a name="2422616">From Java, the method signatures for the </a><span class="cv_-_computer_voice">execute</span> methods (there are multiple variants) take a <span class="cv_-_computer_voice">GWRunnable</span> for the block argument. <span class="cv_-_computer_voice">GWRunnable</span> is a simple interface that contains a single method, called <span class="cv_-_computer_voice">run</span>. Instead of using a block, you can define an in-line anonymous Java class that implements the <span class="cv_-_computer_voice">run</span> method. This is analogous to the standard Java design pattern for creating an anonymous class to use the standard class <span class="cv_-_computer_voice">java.lang.Runnable</span>.</div>
      <div class="B_-_Body"><a name="2422617">For example:</a></div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422619">GWRunnable myBlock=new GWRunnable() {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422620">&nbsp;&nbsp;public void run() {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422621">&nbsp;&nbsp;&nbsp;&nbsp;System.out.println("I am startable plugin code running in an anonymous inner class");</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422622">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422623">&nbsp;&nbsp;&nbsp;// add more code here...</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422624">&nbsp;&nbsp;}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422625">};</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422626">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2422627">_callbackHandler.execute(myBlock);</a></PRE>
      <div class="B_-_Body"><a name="2422630">For information about Gosu blocks and inner classes, see </a><a href="javascript:WWHClickedPopup('gosu', 'classes.12.6.html#2464956', '');" title="Inner Classes">“Gosu Block Shortcut for Anonymous Classes Implementing an Interface” in the </a><span class="bt_-_book_title"><a href="javascript:WWHClickedPopup('gosu', 'classes.12.6.html#2464956', '');" title="Inner Classes">Gosu Reference Guide</a></span>.</div>
      <div class="H3_-_Heading_3_outer" style="margin-left: 36pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <h5 class="H3_-_Heading_3_inner" style="width: 18pt; white-space: nowrap"></h5>
            </td>
            <td width="100%">
              <h5 class="H3_-_Heading_3_inner"><a name="2422632">Where to Put Java Files for Your Startable Plugin</a></h5>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="2422633">If you have Java files for your startable plugin, place your Java class and libraries files in the same places as with other plugin types.</a></div>
      <div class="B_-_Body"><a name="2422634">The instructions are slightly different depending on whether you define the plugin interface implementation itself in Java or in Gosu:</a></div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="2422638">If your main startable plugin class is a Java class, see </a><a href="javascript:WWHClickedPopup('integration', 'plugins.15.06.html#2846404', '');" title="Special Notes For Java Plugins">“Special Notes For Java Plugins”</a>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="2422641">If your main startable plugin class is a Gosu class, see </a><a href="javascript:WWHClickedPopup('integration', 'plugins.15.05.html#2559217', '');" title="Example Gosu Plugin">“If Your Gosu Plugin Needs Java Classes and Library Files”</a>.</div>
            </td>
          </tr>
        </table>
      </div>
      <h4 class="H2_-_Heading_2"><a name="2422643">Persistence and Startable Plugins</a></h4>
      <div class="B_-_Body"><a name="2422644">Your startable plugin can manipulate Guidewire entity data. If your startable plugin needs to maintain state for itself, do one of the following:</a></div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="2422645">Create your own custom persistent entity types that track the internal state information of the startable plugin.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="2422646">Use the system parameter table for persistence.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <h4 class="H2_-_Heading_2"><a name="2422647">Starting and Stopping Startable Plugins</a></h4>
      <div class="B_-_Body"><a name="2422650">You can start and stop startable plugins from SOAP APIs. For more information, see </a><a href="javascript:WWHClickedPopup('integration', 'webservices-general.11.4.html#3428855', '');" title="Maintenance Web Services">“Starting or Stopping Startable Plugins”</a>.</div>
      <div class="B_-_Body"><a name="2381109">&nbsp;</a></div>
      <script type="text/javascript" language="JavaScript1.2">
        <!--
          // Clear related topics
          //
          WWHClearRelatedTopics();

          document.writeln(WWHRelatedTopicsInlineHTML());
        // -->
      </script>
    </blockquote>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        document.write(WWHRelatedTopicsDivTag() + WWHPopupDivTag() + WWHALinksDivTag());
      // -->
    </script>
  </body>
</html>