<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <!-- MOTW-DISABLED saved from url=(0014)about:internet -->
    <title>Preupdate Handler Plugin</title>
    <link rel="StyleSheet" href="css/plugins-other.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/context.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/towwhdir.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/wwhpagef.js"></script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        var  WebWorksRootPath = "";
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        // Set reference to top level help frame
        //
        var  WWHFrame = WWHGetWWHFrame("", true);
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2" src="scripts/expand.js"></script>
    <!-- THE FOLLOWING IS A GUIDEWIRE STYLE DEFINITION FOR THE LINK TO THIS FEATURE -->
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <!-- THE FOLLOWING IS A GUIDEWIRE GSCRIPT FUNCTION FOR THE LINK TO THIS FEATURE -->
    <script type="text/javascript">
function guidewire_selectall()
{
var text_val=eval("document.linktothisurlform.urlfield");
text_val.focus();
text_val.select();
}
</script>
  </head>
  <body onLoad="WWHUpdate();" onUnload="WWHUnload();" onKeyDown="WWHHandleKeyDown((document.all||document.getElementById||document.layers)?event:null);" onKeyPress="WWHHandleKeyPress((document.all||document.getElementById||document.layers)?event:null);" onKeyUp="WWHHandleKeyUp((document.all||document.getElementById||document.layers)?event:null);">
    <!-- THE FOLLOWING IS A GUIDEWIRE DIV FOR THE 'LINK TO THIS' FEATURE -->
    <div id="linkToThisPage" class="popup" style="display: none;">
      <div class="popupTitle">Link Directly to This Page 
           <a href="#" onclick="var thePopup = getElementById('linkToThisPage');thePopup.style.display='none';return false;"><img class="popupClosebox" src="wwhelp/wwhimpl/common/images/close.gif" /></a></div>
      <div style="padding:6px;">
        <div class="popupText" id="linkToThisPageBookmark">An error has occurred if you see this messsage.</div>
        <form name="linktothisurlform" method="post" action="" style="width:275px;margin:0px">
          <input type="text" class="popupURLText" id="linkToThisPageURL" name="urlfield" rows="1" cols="55" onClick="guidewire_selectall();" onFocus="guidewire_selectall();"></input>
        </form>
      </div>
    </div>
    <br />
    <div class="WebWorks_Breadcrumbs" style="text-align: left;">
      <span>ClaimCenter Integration Guide</span> : 
    <span class="WebWorks_Breadcrumbs" style="text-align: left;"><a class="WebWorks_Breadcrumb_Link" href="p-plugins.html#2408960">Plugins</a> : <a class="WebWorks_Breadcrumb_Link" href="plugins-other.23.01.html#2408960">Other Plugin Interfaces</a> : Preupdate Handler Plugin</span></div>
    <hr align="left" />
    <blockquote>
      <h3 class="H1_-_Heading_1"><a name="2408960">Preupdate Handler Plugin</a></h3>
      <div class="B_-_Body"><a name="2530724">In some cases it makes sense to implement preupdate handling in plugin code rather than in a rule set. To implement preupdate handling in plugin code, register an implementation of the </a><span class="cv_-_computer_voice">IPreUpdateHandler</span> plugin interface. </div>
      <div class="B_-_Body"><a name="2545470">It is best to use </a><span class="cv_-_computer_voice">IPreUpdateHandler</span> plugin instead of <span class="cv_-_computer_voice">Preupdate Rules</span> in the following cases:</div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="ri_-_run_in_header"><a name="2545678">If you need to create entity instances</a></span> – If you have tasks that must create new entity instances, the plugin approach is best. The application calls the <span class="cv_-_computer_voice">IPreUpdateHandler</span> plugin before calling the rule set. The Preupdate rules run on all new entities created by the <span class="cv_-_computer_voice">IPreUpdateHandler</span> plugin implementation. You can separate your code into tasks that create objects in the plugin, and other tasks in the rule set. Without using the plugin, a Preupdate rule that creates a new entity must incorporate the logic in Preupdate rules that explicitly check the new entity instances also.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="ri_-_run_in_header"><a name="2545679">If you need to manipulate removed / deleted entity instances</a></span> – Similarly, this plugin is good for tasks that must deal with removed objects, entity instances that on commit will delete or retire in the database. A Preupdate rule set for a particular entity type does not run simply for removal of the deleted object. Only add or change of an entity instance triggers Preupdate and Validation rule sets for that entity type. However, the <span class="cv_-_computer_voice">IPreUpdateHandler</span> has direct access to removed entity instances in the bundle. Therefore, it is best that work that involves removed objects, and optionally new and changed objects, happen in the <span class="cv_-_computer_voice">IPreUpdateHandler</span> plugin implementation.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LP_-_List_Para"><a name="2545746">For example in ClaimCenter, deleting a check also deletes its payments and other subobjects. The action only retires </a><span class="cv_-_computer_voice">Transaction</span> entities, and no <span class="cv_-_computer_voice">Transaction</span> entities are added or changed. Therefore, the <span class="cv_-_computer_voice">TransactionSet</span> Preupdate rules do not run. This behavior might interact with other customizations you might add. For example, suppose you maintain a property on another entity type to track payment totals of a certain type. You must track add, change, and delete for <span class="cv_-_computer_voice">Payment</span> objects to update the total. However, a <span class="cv_-_computer_voice">TransactionSet</span> Preupdate rule to do this fails to catch removal of payments when the entire <span class="cv_-_computer_voice">Check</span> deletes in the user interface. Relying on a <span class="cv_-_computer_voice">TransactionSet</span> Preupdate rule thus requires additional code to handle this edge case. In contrast, you can do all this work in one place by using the <span class="cv_-_computer_voice">IPreUpdateHandler</span> plugin.</div>
      <div class="B_-_Body"><a name="2530759">Registering and enabling this plugin is sufficient for ClaimCenter to call the plugin for preupdate, independent of the server </a><span class="cv_-_computer_voice">config.xml</span> parameter <span class="cv_-_computer_voice">UseOldStylePreUpdate</span>.</div>
      <div class="B_-_Body"><a name="2408330">Next, if the server </a><span class="cv_-_computer_voice">config.xml</span> parameter <span class="cv_-_computer_voice">UseOldStylePreUpdate</span> is set to <span class="cv_-_computer_voice">true</span>, ClaimCenter additionally calls the validation-graph based Preupdate rule set after calling the plugin. </div>
      <div class="B_-_Body"><a name="2401211">Your plugin implementation must implement one method, </a><span class="cv_-_computer_voice">executePreUpdate</span>. This method takes a single preupdate context object, <span class="cv_-_computer_voice">PreUpdateContext</span>, and returns nothing. </div>
      <div class="B_-_Body"><a name="2401213">The </a><span class="cv_-_computer_voice">PreUpdateContext</span> object has several properties you can get, which return a list (<span class="cv_-_computer_voice">java.util.List</span>) of entities in the current database transaction. </div>
      <div class="B_-_Body"><a name="2401214">From Gosu they look like the following properties:</a></div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="cv_-_computer_voice"><a name="2401215">InsertedBeans</a></span> – An unordered list of entities added in this transaction. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="cv_-_computer_voice"><a name="2401216">UpdatedBeans</a></span> – An unordered list of entities changed in this transaction. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="cv_-_computer_voice"><a name="2401217">RemovedBeans</a></span> – An unordered list of entities added in this transaction. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="2545362">From Java, these properties appear as three methods: </a><span class="cv_-_computer_voice">getInsertedBeans</span>, <span class="cv_-_computer_voice">getUpdatedBeans</span>, and <span class="cv_-_computer_voice">getRemovedBeans</span>.</div>
      <div class="B_-_Body"><a name="2545366">For an overview of preupdate rules, see </a><a href="javascript:WWHClickedPopup('rules', 'cc_rulesets.09.14.html#17012332', '');" title="Preupdate Rule Set Category">“Preupdate Rule Set Category” in the </a><span class="bt_-_book_title"><a href="javascript:WWHClickedPopup('rules', 'cc_rulesets.09.14.html#17012332', '');" title="Preupdate Rule Set Category">Rules Guide</a></span></div>
      <h6 class="HS_-_Head_Sub"><a name="2545370">Default Plugin Implementation</a></h6>
      <div class="B_-_Body"><a name="2544277">In the base configuration, ClaimCenter provides the plugin implementation </a><span class="cv_-_computer_voice">gw.plugin.preupdate.impl.CCPreUpdateHandlerImpl</span>.</div>
      <div class="B_-_Body"><a name="2401236">By default, this plugin implementation class collects all inserted and updated beans. </a></div>
      <div class="B_-_Body"><a name="2408862">Any exception cause the bounding database transaction to roll back, effectively undoing the update.</a></div>
      <div class="B_-_Body"><a name="2497501">The ClaimCenter default implementation creates </a><span class="cv_-_computer_voice">Exposure</span> for Workers Compensation claims and calls Reinsurance plugins as appropriate.</div>
      <script type="text/javascript" language="JavaScript1.2">
        <!--
          // Clear related topics
          //
          WWHClearRelatedTopics();

          document.writeln(WWHRelatedTopicsInlineHTML());
        // -->
      </script>
    </blockquote>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        document.write(WWHRelatedTopicsDivTag() + WWHPopupDivTag() + WWHALinksDivTag());
      // -->
    </script>
  </body>
</html>