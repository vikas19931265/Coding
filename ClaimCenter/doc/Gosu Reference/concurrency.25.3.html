<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <!-- MOTW-DISABLED saved from url=(0014)about:internet -->
    <title>Request and Session Scoped Variables</title>
    <link rel="StyleSheet" href="css/concurrency.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/context.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/towwhdir.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/wwhpagef.js"></script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        var  WebWorksRootPath = "";
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        // Set reference to top level help frame
        //
        var  WWHFrame = WWHGetWWHFrame("", true);
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2" src="scripts/expand.js"></script>
    <!-- THE FOLLOWING IS A GUIDEWIRE STYLE DEFINITION FOR THE LINK TO THIS FEATURE -->
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <!-- THE FOLLOWING IS A GUIDEWIRE GSCRIPT FUNCTION FOR THE LINK TO THIS FEATURE -->
    <script type="text/javascript">
function guidewire_selectall()
{
var text_val=eval("document.linktothisurlform.urlfield");
text_val.focus();
text_val.select();
}
</script>
  </head>
  <body onLoad="WWHUpdate();" onUnload="WWHUnload();" onKeyDown="WWHHandleKeyDown((document.all||document.getElementById||document.layers)?event:null);" onKeyPress="WWHHandleKeyPress((document.all||document.getElementById||document.layers)?event:null);" onKeyUp="WWHHandleKeyUp((document.all||document.getElementById||document.layers)?event:null);">
    <!-- THE FOLLOWING IS A GUIDEWIRE DIV FOR THE 'LINK TO THIS' FEATURE -->
    <div id="linkToThisPage" class="popup" style="display: none;">
      <div class="popupTitle">Link Directly to This Page 
           <a href="#" onclick="var thePopup = getElementById('linkToThisPage');thePopup.style.display='none';return false;"><img class="popupClosebox" src="wwhelp/wwhimpl/common/images/close.gif" /></a></div>
      <div style="padding:6px;">
        <div class="popupText" id="linkToThisPageBookmark">An error has occurred if you see this messsage.</div>
        <form name="linktothisurlform" method="post" action="" style="width:275px;margin:0px">
          <input type="text" class="popupURLText" id="linkToThisPageURL" name="urlfield" rows="1" cols="55" onClick="guidewire_selectall();" onFocus="guidewire_selectall();"></input>
        </form>
      </div>
    </div>
    <br />
    <div class="WebWorks_Breadcrumbs" style="text-align: left;">
      <span>Gosu Reference Guide</span> : 
    <span class="WebWorks_Breadcrumbs" style="text-align: left;"><a class="WebWorks_Breadcrumb_Link" href="concurrency.25.1.html#1443367">Concurrency</a> : Request and Session Scoped Variables</span></div>
    <hr align="left" />
    <blockquote>
      <h3 class="H1_-_Heading_1"><a name="1443367">Request and Session Scoped Variables</a></h3>
      <div class="B_-_Body"><a name="1511443">To create a variable that can safely be accessed in the request or session scope, use the following two classes in the </a><span class="cv_-_computer_voice">gw.api.web</span> package:</div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="cv_-_computer_voice"><a name="1508147">RequestVar</a></span> – Instantiate this class to create a request-scoped variable stored in the web request</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="cv_-_computer_voice"><a name="1508252">SessionVar</a></span> – Instantiate this class to create a session-scoped variable stored in the web session</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="1508163">These classes create a variable with a well-defined lifecycle and attachment point of either the request or session.</a></div>
      <div class="B_-_Body"><a name="1513757">Use the </a><span class="cv_-_computer_voice">set</span> method to set the variable value. Use the <span class="cv_-_computer_voice">get</span> method to get the variable value. </div>
      <div class="B_-_Body"><a name="1513759">For both objects, from Gosu there is a </a><span class="cv_-_computer_voice">RequestAvailable</span> property. Check the value of this <span class="cv_-_computer_voice">boolean</span> property to see if there is a request (for <span class="cv_-_computer_voice">RequestVar</span>) or a session (for <span class="cv_-_computer_voice">SessionVar</span>) available in this programming context. For example, if the code was called from a non-web unit test or a batch process, these properties return <span class="cv_-_computer_voice">false</span>. If <span class="cv_-_computer_voice">RequestAvailable</span> returns <span class="cv_-_computer_voice">false</span>, it is unsafe to call either <span class="cv_-_computer_voice">get</span> or <span class="cv_-_computer_voice">set</span> methods on them. From Java, these properties appear as the <span class="cv_-_computer_voice">isRequestAvailable</span> method on each object.</div>
      <div class="NW_-_Note_Warning">
        <span class="w_-_warning">WARNING  </span><a name="1510274">Rule sets, plugin code, and other Gosu code can be invoked through various code contexts. You may not encounter contexts other than the user interface until late in system testing. When getting values </a><span class="cv_-_computer_voice">RequestVar</span> and <span class="cv_-_computer_voice">SessionVar</span>, always use <span class="cv_-_computer_voice">RequestAvailable</span> before trying to access the variable. Always handle the variable not being available or if it returns a <span class="cv_-_computer_voice">null</span> value. </div>
      <div class="B_-_Body"><a name="1513854">The recommended pattern for concurrent use is to store the instance of the variable as a class variable declared with the </a><span class="cv_-_computer_voice">static</span> keyword. By using the <span class="cv_-_computer_voice">static</span> keyword on the class, varied programming contexts can access the same session variable or request variable. Use the generics syntax <span class="cv_-_computer_voice">SessionVar&lt;</span><span class="pst_-_parameter_in_code_snippets_table">TYPE</span><span class="cv_-_computer_voice">&gt;</span> when you define the variable. For example, to store a <span class="cv_-_computer_voice">String</span> object, define the type as <span class="cv_-_computer_voice">SessionVar&lt;String&gt;</span>. For more information about Gosu generics, see <a href="javascript:WWHClickedPopup('gosu', 'generics.19.1.html#1455314', '');" title="Gosu Generics">“Gosu Generics”</a>.</div>
      <div class="B_-_Body"><a name="1513406">For example:</a></div>
      <PRE class="CM_-_Code_Middle_Line"><a name="1512724">class MyClass {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line" style="font-style: normal; font-variant: normal; font-weight: bold; text-transform: none; vertical-align: baseline"><span class="s_-_strong"><a name="1512725">&nbsp;&nbsp;static var _varStoredInSession = new SessionVar&lt;String&gt;()</a></span></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1512726">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1512727">&nbsp;&nbsp;static property get MySessionVar() : String {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1512728">&nbsp;&nbsp;&nbsp;&nbsp;if ( _varStoredInSession.RequestAvailable ) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1512729">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return _varStoredInSession.get()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1512730">&nbsp;&nbsp;&nbsp;&nbsp;} else {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1512731">&nbsp;&nbsp;&nbsp;&nbsp;return null // ENSURE THE CALLER CHECKS FOR NULL</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1512732">&nbsp;&nbsp;&nbsp;&nbsp;}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1512733">&nbsp;&nbsp;}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1512734">  </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1512843">&nbsp;&nbsp;static property set MySessionVar( value: String ) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1512735">&nbsp;&nbsp;&nbsp;&nbsp;if ( _varStoredInSession.RequestAvailable ) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1512736">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_varStoredInSession.set( value )</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1512737">&nbsp;&nbsp;&nbsp;&nbsp;}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1512945">&nbsp;&nbsp;&nbsp;&nbsp;else {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1512966">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// decide what to do if the request is not available</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1512958">&nbsp;&nbsp;&nbsp;&nbsp;}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1512738">&nbsp;&nbsp;}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1509906">}</a></PRE>
      <div class="B_-_Body"><a name="1513617">In any other part of the application, you can write code that set this property:</a></div>
      <PRE class="CM_-_Code_Middle_Line"><a name="1513150">MyClass.MySessionVar = "hello"</a></PRE>
      <div class="B_-_Body"><a name="1513669">In another part of the application, you can write code that gets this property:</a></div>
      <PRE class="CM_-_Code_Middle_Line"><a name="1513153">print( MyClass.MySessionVar )</a></PRE>
      <div class="B_-_Body"><a name="1512710">Note that the example explicitly checks the </a><span class="cv_-_computer_voice">RequestAvailable</span> property. In real code, you must decide what you want to do if <span class="cv_-_computer_voice">RequestAvailable</span> returns <span class="cv_-_computer_voice">false</span> to support your batch processes for example.</div>
      <div class="B_-_Body"><a name="1511418">It is strongly recommended to use </a><span class="cv_-_computer_voice">RequestVar</span> and <span class="cv_-_computer_voice">SessionVar</span> rather than the Java thread local API <span class="cv_-_computer_voice">java.lang.ThreadLocal&lt;</span><span class="pst_-_parameter_in_code_snippets_table">TYPE</span><span class="cv_-_computer_voice">&gt;</span>. Because application servers pool their threads, using <span class="cv_-_computer_voice">ThreadLocal</span> increases risks of data that stays around forever as a memory leak, since the thread you attached it to never dies. Also, pooled threads can preserve stale data from a previous request, since the server thread pool reuses the thread for future requests. If you ever use a <span class="cv_-_computer_voice">ThreadLocal</span>, it is critical to be very careful to clean up all code carefully with a <span class="cv_-_computer_voice">try</span>/<span class="cv_-_computer_voice">finally</span> block. Alternatively, convert that code to use <span class="cv_-_computer_voice">RequestVar</span> and <span class="cv_-_computer_voice">SessionVar</span>.</div>
      <script type="text/javascript" language="JavaScript1.2">
        <!--
          // Clear related topics
          //
          WWHClearRelatedTopics();

          document.writeln(WWHRelatedTopicsInlineHTML());
        // -->
      </script>
    </blockquote>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        document.write(WWHRelatedTopicsDivTag() + WWHPopupDivTag() + WWHALinksDivTag());
      // -->
    </script>
  </body>
</html>