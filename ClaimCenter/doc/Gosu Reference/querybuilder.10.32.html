<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <!-- MOTW-DISABLED saved from url=(0014)about:internet -->
    <title>Updating Entity Instances in Query Results</title>
    <link rel="StyleSheet" href="css/querybuilder.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/context.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/towwhdir.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/wwhpagef.js"></script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        var  WebWorksRootPath = "";
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        // Set reference to top level help frame
        //
        var  WWHFrame = WWHGetWWHFrame("", true);
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2" src="scripts/expand.js"></script>
    <!-- THE FOLLOWING IS A GUIDEWIRE STYLE DEFINITION FOR THE LINK TO THIS FEATURE -->
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <!-- THE FOLLOWING IS A GUIDEWIRE GSCRIPT FUNCTION FOR THE LINK TO THIS FEATURE -->
    <script type="text/javascript">
function guidewire_selectall()
{
var text_val=eval("document.linktothisurlform.urlfield");
text_val.focus();
text_val.select();
}
</script>
  </head>
  <body onLoad="WWHUpdate();" onUnload="WWHUnload();" onKeyDown="WWHHandleKeyDown((document.all||document.getElementById||document.layers)?event:null);" onKeyPress="WWHHandleKeyPress((document.all||document.getElementById||document.layers)?event:null);" onKeyUp="WWHHandleKeyUp((document.all||document.getElementById||document.layers)?event:null);">
    <!-- THE FOLLOWING IS A GUIDEWIRE DIV FOR THE 'LINK TO THIS' FEATURE -->
    <div id="linkToThisPage" class="popup" style="display: none;">
      <div class="popupTitle">Link Directly to This Page 
           <a href="#" onclick="var thePopup = getElementById('linkToThisPage');thePopup.style.display='none';return false;"><img class="popupClosebox" src="wwhelp/wwhimpl/common/images/close.gif" /></a></div>
      <div style="padding:6px;">
        <div class="popupText" id="linkToThisPageBookmark">An error has occurred if you see this messsage.</div>
        <form name="linktothisurlform" method="post" action="" style="width:275px;margin:0px">
          <input type="text" class="popupURLText" id="linkToThisPageURL" name="urlfield" rows="1" cols="55" onClick="guidewire_selectall();" onFocus="guidewire_selectall();"></input>
        </form>
      </div>
    </div>
    <br />
    <div class="WebWorks_Breadcrumbs" style="text-align: left;">
      <span>Gosu Reference Guide</span> : 
    <span class="WebWorks_Breadcrumbs" style="text-align: left;"><a class="WebWorks_Breadcrumb_Link" href="querybuilder.10.01.html#2564207">Query Builder APIs</a> : <a class="WebWorks_Breadcrumb_Link" href="querybuilder.10.26.html#2564207">Working with Results</a> : Updating Entity Instances in Query Results</span></div>
    <hr align="left" />
    <blockquote>
      <h4 class="H2B_-_Heading_2_Break"><a name="2564207">Updating Entity Instances in Query Results</a></h4>
      <div class="B_-_Body"><a name="2239466">Entities that you iterate across in a query result are read-only by default. The query builder APIs load iterated entities into a read-only </a><span class="e_-_emphasis">bundle</span>. A bundle is a collection of entities loaded from the database into server memory that represents a transactional unit of information. The read-only bundles that contain iterated query results are separate from the active read-write bundles of running code. You cannot update the properties of query result entities while they remain in the read-only bundle of the result. </div>
      <div class="H3_-_Heading_3_outer" style="margin-left: 36pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <h5 class="H3_-_Heading_3_inner" style="width: 18pt; white-space: nowrap"></h5>
            </td>
            <td width="100%">
              <h5 class="H3_-_Heading_3_inner"><a name="2239468">Moving Entities from Query Results to Writable Bundles</a></h5>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="2863998">To change the properties of entities in query results, you must move the entities from the query result to a writable bundle. To move an entity to a writable bundle, call the </a><span class="cv_-_computer_voice">add</span> method on the writable bundle and save the result of the <span class="cv_-_computer_voice">add</span> method in a variable. Whenever you pass an entity from a read-only bundle to a writable bundle, the <span class="cv_-_computer_voice">add</span> method returns a clone of the entity instance that you passed to the method. </div>
      <div class="B_-_Body"><a name="2864647">If you move an entity from a query result to a writable bundler, store the entity reference that the a</a><span class="cv_-_computer_voice">dd</span> method returns in a variable. Then, modify the properties on the saved entity reference. Do not modify properties on the original entity reference that remains in the result set or its iterator. Avoid keeping any references to the original entity instance whenever possible.</div>
      <div class="H3_-_Heading_3_outer" style="margin-left: 36pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <h5 class="H3_-_Heading_3_inner" style="width: 18pt; white-space: nowrap"></h5>
            </td>
            <td width="100%">
              <h5 class="H3_-_Heading_3_inner"><a name="2863993">Moving Entities from Query Results to the Current Bundle</a></h5>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="2865069">Most programming contexts have a writable bundle that the application prepares and manages. For example, all rule execution contexts and PCF code has a current bundle. When a current bundle exists, get it by using the </a><span class="cv_-_computer_voice">getCurrent</span> method. </div>
      <div class="B_-_Body"><a name="2863995">Typically, whenever you want to update an entity in a query result, you move it to the current bundle. While you iterate the result, add each entity to the current bundle and make changes to the version of it that the </a><span class="cv_-_computer_voice">add</span> method returns. After you finish iterating the query result and the execution context finishes, the application commits all the changes that you made to the database. </div>
      <div class="NI_-_Note_Important">
        <span class="n_-_note">IMPORTANT   </span><a name="2865403">Entities must not exist in more than one writable bundle at a time.</a></div>
      <div class="B_-_Body"><a name="2239471">For example:</a></div>
      <PRE class="CF_-_Code_First_Line"><a name="2239472">// Get the current bundle from the programming context. </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2239473">var </a><span class="s_-_strong">bundle</span> = gw.transaction.Transaction.<span class="s_-_strong">getCurrent()</span></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2239474">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2867073">var query = gw.api.database.Query.make(Address)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2867074">query.compare("State", Equals, typekey.State.TC_IL)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2867075">var result = query.select().orderBy(\row-&gt; row.City)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2867076">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2867077">for (address in result) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2867078">&nbsp;&nbsp;if ((exists (city in {"Schaumburg", "Melrose Park", "Norridge"} where address.City == city))) { </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2867079">&nbsp;&nbsp;&nbsp;&nbsp;continue</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2867080">&nbsp;&nbsp;}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2867081">&nbsp;&nbsp;else {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2896409">&nbsp;&nbsp;&nbsp;&nbsp;// Add the address to the current bundle to make it writeable and</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2896410">&nbsp;&nbsp;&nbsp;&nbsp;// discard the read-only reference obtained from the query result. </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2896411">&nbsp;&nbsp;&nbsp;&nbsp;address = </a><span class="s_-_strong">bundle.add</span>(address)</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2867084">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2867085">&nbsp;&nbsp;&nbsp;&nbsp;// Change properties on the writeable address. </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2867086">&nbsp;&nbsp;&nbsp;&nbsp;address.Description = </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2886580">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Use a Gosu string template to concatenate the current description and the new text. </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2886513">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"${address.Description}; This city is not Schaumburg, Melrose Park, or Norridge.."</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2867087">&nbsp;&nbsp;}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2867088">&nbsp;</a></PRE>
      <PRE class="CL_-_Code_Last_Line"><a name="2866591">}</a></PRE>
      <div class="B_-_Body"><a name="2867103">At the time the execution context for the preceding code finishes, the application commits all changes made to addresses in the current bundle to the database. </a></div>
      <div class="B_-_Body"><a name="2867207">To run the preceding code in the Gosu Scratchpad, add the statement </a><span class="cv_-_computer_voice">bundle.commit()</span> after the <span class="cv_-_computer_voice">for</span> block. To see the effects of the preceding code, run the following Gosu code.</div>
      <PRE class="CF_-_Code_First_Line"><a name="2867346">// Query the database for addresses in Illinois.</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2867347">var query = gw.api.database.Query.make(Address)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2867348">query.compare("State", Equals, typekey.State.TC_IL)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2867349">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2867350">// Configure the result to be ordered by City. </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2867351">var result = query.select()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2867353">result.orderBy(\ row -&gt; row.City)  </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2867354">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2867355">// Iterate and print the result set. </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2867356">for (address in result) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2867357">&nbsp;&nbsp;print(address.City + ", " + address.Description)</a></PRE>
      <PRE class="CL_-_Code_Last_Line"><a name="2867340">} </a></PRE>
      <h6 class="HS_-_Head_Sub"><a name="2863525">See also</a></h6>
      <div class="B_-_Body"><a href="javascript:WWHClickedPopup('gosu', 'transactions.22.01.html#1456387', '');" title="Bundles and Database Transactions" name="2772875">“Bundles and Database Transactions”</a></div>
      <script type="text/javascript" language="JavaScript1.2">
        <!--
          // Clear related topics
          //
          WWHClearRelatedTopics();

          document.writeln(WWHRelatedTopicsInlineHTML());
        // -->
      </script>
    </blockquote>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        document.write(WWHRelatedTopicsDivTag() + WWHPopupDivTag() + WWHALinksDivTag());
      // -->
    </script>
  </body>
</html>